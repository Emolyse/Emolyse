<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - collada - skinning</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            color: #000;
            font-family:Monospace;
            font-size:13px;
            text-align:center;

            background-color: #000;
            margin: 0px;
            overflow: hidden;
        }

        #info {
            position: absolute;
            top: 0px; width: 100%;
            padding: 5px;
        }

        a {

            color: #f00;
        }

    </style>
</head>
<body>

<div id="container"></div>

<div id="info">
    <a href="http://threejs.org" target="_blank">three.js</a> webgl - collada - skinning
</div>

<script src="http://threejs.org/build/three.min.js"></script>
<script src="js/ColladaLoader.js"></script>
<script src="js/Detector.js"></script>
<script src="js/stats.min.js"></script>

<script>

    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

    var container, stats;
    var camera, scene, renderer, backgroundScene, backgroundCamera;
    var clock = new THREE.Clock();

    init();

    function init() {

        container = document.getElementById( 'container' );

        var axeX, axeY, axeZ;
        var geometry = new THREE.Geometry();
        geometry.vertices.push(
                new THREE.Vector3( 0, 0, 0 ),
                new THREE.Vector3( 100, 0, 0 )
        );

        var geometry2 = new THREE.Geometry();
        geometry2.vertices.push(
                new THREE.Vector3( 0, 0, 0 ),
                new THREE.Vector3( 0, 100, 0 )
        );

        var geometry3 = new THREE.Geometry();
        geometry3.vertices.push(
                new THREE.Vector3( 0, 0, 0 ),
                new THREE.Vector3( 0, 0, 100 )
        );

        axeX = new THREE.Line(geometry, new THREE.LineBasicMaterial({color:0xff0000}));
        axeY = new THREE.Line(geometry2, new THREE.LineBasicMaterial({color:0x00ff00}));
        axeZ = new THREE.Line(geometry3, new THREE.LineBasicMaterial({color:0x0000ff}));


        camera = new THREE.PerspectiveCamera( 25, window.innerWidth / window.innerHeight, 1, 10000 );
        camera.position.set( 1, 2, 7 );
        camera.lookAt( new THREE.Vector3(1,1,0));

        camera.up.x=0;
        camera.up.y=0;
        camera.up.z=0;

        scene = new THREE.Scene();
        scene.add(axeX);
        scene.add(axeY);

        scene.add(axeZ);
        var light = new THREE.PointLight(0xffffff);
        scene.add( light );
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setClearColor( 0xfff4e5 );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.sortObjects = false;

        container.appendChild( renderer.domElement );
        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';


        container.appendChild( stats.domElement );
        var loader = new THREE.ColladaLoader();
        loader.load( "3D/avatar.dae", function ( collada ) {

            collada.scene.traverse( function ( child ) {

                if ( child instanceof THREE.SkinnedMesh ) {

                    var animation = new THREE.Animation( child, child.geometry.animation );
                    console.log(animation);
                    child.rotateX(-Math.PI/2);
                    child.rotateZ(Math.PI/2);
                    animation.play();

                }

            } );
            scene.add( collada.scene );
            console.log(collada);

        } );

        var texture = THREE.ImageUtils.loadTexture( 'img/env.jpg' );
        var backgroundMesh = new THREE.Mesh(
                new THREE.PlaneGeometry(2, 2, 0),
                new THREE.MeshBasicMaterial({
                    map: texture
                }));

        backgroundMesh .material.depthTest = false;
        backgroundMesh .material.depthWrite = false;

        // Create your background scene
        backgroundScene = new THREE.Scene();
        backgroundCamera = new THREE.Camera();
        backgroundScene .add(backgroundCamera );
        backgroundScene .add(backgroundMesh );

        window.addEventListener( 'resize', onWindowResize, false );

        animate();

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function animate() {

        requestAnimationFrame( animate, renderer.domElement );

        THREE.AnimationHandler.update( clock.getDelta() );

        renderer.autoClear = false;
        renderer.clear();
        renderer.render( backgroundScene, backgroundCamera);
        renderer.render( scene, camera );

        stats.update();

    }

</script>

</body>
</html>